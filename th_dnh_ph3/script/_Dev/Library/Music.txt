//Used by system script - 
//others interface with functions in Functions.txt
//with same names/parameters as these
//that notify system script to actually call these ones.

let music = GetCommonData("MusicObject",ObjSound_Create);
SetCommonData("MusicObject",music);






function SetBGM(title,loopstart,loopend){
	SetCommonData("CurrentBGM",title); SetCommonData("MusicObject",music);
	if(ObjSound_IsPlaying(music)){
		descent(i in 0..60){
			ObjSound_SetVolumeRate(music,100*i/60);
			yield;
		}
		ObjSound_Stop(music);
	}
	ShowBGMTitle("BGM - "~title);
	ObjSound_Load(music,dirbgm~"bgm - "~title~".ogg");
	ObjSound_SetSoundDivision(music, SOUND_BGM);
	ObjSound_SetLoopEnable(music,true);
	ObjSound_SetRestartEnable(music,true);	
	ObjSound_SetLoopTime(music,loopstart,loopend);
	ObjSound_SetVolumeRate(music,100);
	ObjSound_Play(music);	
}


task FadeBGM{
	descent(i in 0..60){
		ObjSound_SetVolumeRate(music,100*i/60);
		yield;
	}
	ObjSound_Stop(music);
}












function PauseBGM{
	ObjSound_Stop(music);
}
function ResumeBGM{
	ObjSound_Play(music);
}






task ShowBGMTitle(title){
	//let obj = makeText(sx-15,sy-20,16,[0,0,255],ALIGNMENT_RIGHT, 0, title);
	let obj = GetCommonData("BGMTitleObject",ObjText_Create);
	SetCommonData("BGMTitleObject",obj);
	Obj_SetVisible(obj,true);
	ObjRender_SetPosition(obj,-15,sy-16,0);
	ObjText_SetMaxWidth(obj,sx);
	ObjText_SetHorizontalAlignment(obj,ALIGNMENT_RIGHT);
	ObjText_SetText(obj,title);
	
	//Less intrusive
	ObjText_SetFontColorTop(   obj, 180, 180, 255);
	ObjText_SetFontColorBottom(obj,  64,  64, 255);
	//More intrusive
	// ObjText_SetFontColorTop(   obj, 255, 255, 255);
	// ObjText_SetFontColorBottom(obj,  180,  180, 255);

	ObjText_SetFontBorderColor(obj,   0,   0, 255);
	ObjText_SetFontBorderType(obj, BORDER_FULL);
	ObjText_SetFontBorderWidth(obj, 1);
	
	
	ObjText_SetFontType(obj, "Cirno");
	Obj_SetRenderPriorityI(obj,79.9999);
	descent(i in 0..40){ //100
		ObjRender_SetY(obj,sy-20+i);
		ObjRender_SetAlpha(obj,200-2*i);
		yield;
	}
	wait(180); //120
	ascent(i in 0..120){ //120
		// ObjRender_SetX(obj,-(15+sx/120*i) );
		ObjRender_SetX(obj,qerp(-15,-15+(0.15*sx),-15-sx,i/120));
		yield;
	}
	// Obj_Delete(obj);
	Obj_SetVisible(obj,false);
}




